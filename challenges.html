<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Challenges — TenaNet CTF</title>
<link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap');
*{margin:0;padding:0;box-sizing:border-box;}
:root{
  --bg-dark:#0a0214;
  --accent1:#8d4af5;
  --accent2:#c084fc;
  --text:#e9d5ff;
  --muted:#a78bfa;
  --success:#6ee7b7;
  --error:#f87171;
  --card-bg:rgba(255,255,255,0.02);
  --solved-bg:rgba(110,231,183,0.1);
}
body{
  font-family:'Poppins',sans-serif;
  background:var(--bg-dark);
  color:var(--text);
  overflow-x:hidden;
  min-height:100vh;
  position:relative;
  /* Custom Cursor - Added per user request */
  cursor: url('data:image/x-icon;base64,AAACAAEAICAAAAAAAACoEAAAFgAAACgAAAAgAAAAQAAAAAEAIAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGgYDuhoGA/8aBgP/GgYD/xoGA/8aBgP/GgYD/xoGA/8aBgP/GgYDugAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABoGAwYaBgPe6urq/+bm5v/i4uL/39/f/9vb2//Y2Nj/1dXV/9PT0/8aBgPhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGgYDYxoGA4fu7u7/6urq/+bm5v/i4uL/39/f/9vb2//Y2Nj/1dXV/xoGA94aBgMwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABoGAwYaBgPex8LC//Hx8f/u7u7/6urq/+bm5v/i4uL/39/f/9vb2//Y2Nj/GgYDhxoGA4cAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGgYDYxoGA7T4+Pj/7u7u//Hx8f/u7u7/7u7u/+Li4v/i4uL/4uLi/9vb2/+wrKv/GgYD1QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABoGAwYaBgPezcnI//v7+//u7u7/7u7u/+7u7v/u7u7/4uLi/+Li4v/i4uL/39/f/9vb2/8aBgPeGgYDMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGgYDYxoGA7T//////f39///////u7u7/7u7u/+7u7v/u7u7/4uLi/+Li4v/i4uL/39/f/xoGA4caBgOHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaBgPez8rK/v///////////////+7u7v/u7u7/7u7u/+7u7v/u7u7/4uLi/+bm5v/i4uL/tbGw/xoGA9UAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGgYDYxoGA7T/////z8rK/v//////////////////////////7u7u/+7u7v/u7u7/7u7u/+bm5v/i4uL/GgYD/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABoGAzYaBgO66Obl//////+Ge3r/////////////////////////////////7u7u/+7u7v/u7u7/6urq/+bm5v8aBgP/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGgYDuujm5f///////////xoGA////////////////////////f39//v7+//4+Pj/9fX1//Hx8f/u7u7/6urq/xoGA/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaBgP/6Obl/+jm5f8aBgO6GgYD/////////////////////////////f39//v7+//4+Pj/GgYD//Hx8f/u7u7/GgYD/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABoGA7oaBgP/GgYDuhoGAzYaBgP///////////8aBgP///////////8aBgP//f39//v7+/8aBgP/9fX1/8O/v/8aBgO6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABoGA////////////xoGA////////////xoGA////////f39/xoGA//JxcT/GgYDuhoGAxoAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGgYD/8/Kyv//////GgYD////////////GgYD///////Pysr/GgYD/xoGA7oaBgMaAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaBgM2GgYDuhoGA/8aBgP///////////8aBgP/GgYD/xoGA7oaBgM2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABoGA////////////xoGA/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGgYD////////////GgYD/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaBgP///////////8aBgP/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABoGA////////////xoGA/8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGgYD////////////GgYD/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAaBgM2GgYD/xoGA7oaBgM2AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//////////////////////////////////////////////////////gB///4Af//+AH///AA///wAP//4AD//+AAf//AAH//wAB//4AAf/8AAH//AAB//xAAf//wAP//8AH///gH///+H////h////4f///+H////h////8///8='), auto;
}
#matrix-canvas,#particles-canvas{
  position:fixed;top:0;left:0;width:100%;height:100%;z-index:-3;
}
header{
  width:100%;max-width:1200px;margin:20px auto;padding:0 20px;
  display:flex;justify-content:space-between;align-items:center;
}
header h1{font-size:2.2em;color:white;text-shadow:0 0 10px rgba(192,132,252,0.8);}
.back-btn{
  background:none;color:var(--muted);
  border:1px solid var(--muted);
  padding:8px 15px;border-radius:12px;
  cursor:pointer;transition:all 0.3s ease;font-weight:600;
}
.back-btn:hover{color:var(--text);border-color:var(--accent2);box-shadow:0 0 15px rgba(192,132,252,0.5);}
.controls{max-width:1200px;margin:40px auto 30px;padding:0 20px;}
.controls h2{color:var(--accent2);margin-bottom:15px;}
.filter-container{display:flex;flex-wrap:wrap;gap:10px;}
.filter-btn{
  background:var(--card-bg);color:var(--muted);
  border:1px solid rgba(255,255,255,0.1);
  padding:8px 15px;border-radius:20px;cursor:pointer;
  transition:all 0.3s ease;font-weight:500;
}
.filter-btn:hover{background:rgba(141,74,245,0.2);color:var(--text);border-color:var(--accent1);}
.filter-btn.active{
  background:linear-gradient(90deg,var(--accent1),var(--accent2));
  color:white;border-color:var(--accent2);
  box-shadow:0 0 15px rgba(141,74,245,0.5);
}
.challenge-grid{
  max-width:1200px;margin:0 auto;padding:0 20px;
  display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
  gap:25px;
}
.challenge-card{
  background:linear-gradient(145deg,var(--card-bg),rgba(255,255,255,0.01));
  padding:25px;border-radius:20px;
  box-shadow:0 4px 15px rgba(0,0,0,0.5);
  transition:all 0.3s ease-in-out;cursor:pointer;
  border:1px solid rgba(255,255,255,0.1);
  position:relative;overflow:hidden;
}
.challenge-card:hover{transform:translateY(-5px) scale(1.01);
  box-shadow:0 12px 40px rgba(141,74,245,0.6);border-color:var(--accent2);}
.status-solved{
  position:absolute;top:0;left:0;width:100%;height:100%;
  background:var(--solved-bg);border:2px solid var(--success);
  border-radius:20px;display:flex;justify-content:center;align-items:center;
  color:var(--success);font-size:2em;font-weight:800;backdrop-filter:blur(3px);
  opacity:0.95;pointer-events:none;z-index:10;
}
.card-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;}
.card-header h3{color:var(--text);font-size:1.25em;font-weight:700;}
.card-header .points-tag{background:var(--accent1);color:white;padding:5px 12px;border-radius:15px;font-size:0.9em;font-weight:700;}
.card-footer{display:flex;justify-content:space-between;align-items:center;margin-top:15px;font-size:0.85em;color:var(--muted);}
.category-tag{padding:3px 8px;border-radius:10px;background:rgba(192,132,252,0.2);color:var(--accent2);font-weight:600;}
.modal-backdrop{
  position:fixed;top:0;left:0;width:100%;height:100%;
  background-color:rgba(0,0,0,0.8);
  display:none;justify-content:center;align-items:center;z-index:100;
  backdrop-filter:blur(5px);
}
.modal-content{
  background-color:var(--bg-dark);padding:30px;border-radius:15px;
  width:90%;max-width:500px;box-shadow:0 10px 50px rgba(141,74,245,0.8);
  border:2px solid var(--accent2);text-align:center;
}
#modal-title{color:var(--accent2);margin-bottom:10px;font-size:1.6em;}
#modal-message{color:var(--text);margin-bottom:25px;font-size:1.1em;}
.modal-button{
  background:linear-gradient(90deg,var(--accent1),var(--accent2));
  color:white;border:none;padding:10px 20px;border-radius:12px;
  cursor:pointer;transition:0.2s;font-weight:700;
}
.modal-button:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(141,74,245,0.5);}
@media (max-width:600px){
  header h1{font-size:1.5em;}
  header{flex-direction:column;gap:15px;}
  .back-btn{margin-top:10px;}
}
</style>
</head>
<body>

<canvas id="matrix-canvas"></canvas>
<canvas id="particles-canvas"></canvas>
<div id="custom-message-modal" class="modal-backdrop"></div>

<header>
  
  <h1>TenaNet CTF Challenges</h1>
  <div style="display:flex;gap:15px;align-items:center;">
    <p style="font-weight:600;font-size:1.1em;color:var(--success);">
      Points: <span id="currentPoints">0</span> |
      Rank: <span id="currentRank">—</span>
    </p>
    
    <button class="back-btn" onclick="location.href='index.html'"><i class='bx bx-arrow-back'></i> Dashboard</button>
    <button class="back-btn" onclick="location.href='leaderboard.html'"><i class='bx bx-trophy'></i> Leaderboard</button>
  
  </div>
</header>

<div class="controls">
  <h2>Filter by Category</h2>
  <div class="filter-container" id="category-filters"></div>
</div>
<div class="challenge-grid" id="challenge-list"></div>

<script>
// --- GLOBAL SECURITY MEASURES (Replaced alert() with console.warn()) ---
document.addEventListener('contextmenu', function(e){
    e.preventDefault();
    console.warn("Security policy violation: Right-click disabled.");
});

document.addEventListener('keydown', function(e){
    const disabledKeys = [
        123, // F12
        // Ctrl+Shift+I, Ctrl+Shift+C, Ctrl+Shift+J
        ...(e.ctrlKey && e.shiftKey ? [73, 67, 74] : []), 
        // Ctrl+U (View Source)
        ...(e.ctrlKey ? [85] : [])
    ];

    if (disabledKeys.includes(e.keyCode)) {
        e.preventDefault();
        console.warn("Security policy violation: Developer tools access prevented.");
    }
});

let devtoolsOpen = false;
setInterval(function() {
    const threshold = 160;
    const widthThreshold = window.outerWidth - window.innerWidth > threshold;
    const heightThreshold = window.outerHeight - window.innerHeight > threshold;
    if (widthThreshold || heightThreshold) {
        if(!devtoolsOpen){
            devtoolsOpen = true;
            console.warn("Security policy violation: Developer tools detected!");
        }
    } else {
        devtoolsOpen = false;
    }
}, 1000);
</script>

<script>
// --- GLOBAL STATE ---
let mockUserPoints = 0;
let activeFilter = 'All';
let loggedInEmail = localStorage.getItem("currentUser") || "anonymous@tenanet.ctf";

/// --- CHALLENGES WITH UNIQUE IDs ---
const challenges = [
    { 
        id: 1, 
        name: "ቀላሉ መንገድ (The Easiest Way)", 
        category: "Forensics", 
        points: 1000, 
        description: "A network packet capture file (.pcap) has been provided. Analyze the traffic to find the hidden flag. <strong>Hint:</strong> Follow the easiest path to extract the data. Download the file: <a href='https://drive.google.com/file/d/1e9ZnolG5_-gfFu5sClUqSTPRLrQdE5KM/view?usp=drive_link' target='_blank' style='color:var(--accent2); text-decoration:underline;'>Click Here for PCAP</a>", 
        status: "unsolved", 
        flag: "TNCTF{PCAP_EASY_FOLLOW}" 
    },
    { 
        id: 3, 
        name: "የመጀመሪያው ቁልፍ (The First Key)", 
        category: "Crypto", 
        points: 1500, 
        description: "This is a classical <strong>Substitution Cipher</strong> challenge. Decrypt the encrypted text file to uncover the hidden flag (TNCTF{...}). <strong>Hint:</strong> Use frequency analysis and look for common English letters and repeated patterns. Download the encrypted text file: <a href='https://drive.google.com/file/d/1cHGn1uQEe3PfBHYDgWUAPvEzlwPTLJd3/view?usp=sharing' target='_blank' style='color:var(--accent2); text-decoration:underline;'>Click Here to Download</a>", 
        status: "unsolved", 
        flag: "TNCTF{mono_sub_rocks}" 
    },
    { 
        id: 4, 
        name: "ተደብቄ አንዳልቀር (I Won't Stay Hidden)", 
        category: "Crypto", 
        points: 2000, 
        description: "Someone sent you this strange message in an email, claiming you’ve won a prize! But something feels phishy 🐟. Can you reveal what’s really hidden behind it? The encrypted message is: <code>85 110 103 86 106 102 123 90 106 104 113 96 95 119 93 105 99 91 96 110 105 115 96 107 125</code>. <strong>Hint:</strong> Each number hides a character — maybe something simple like ASCII — but with a little twist. Remember: always <strong>Think before you decode</strong>.", 
        status: "unsolved", 
        flag: "TNCTF{Think_B3for3_U_Click}" 
    },
    { 
        id: 5, 
        name: "ሌባው የት ሄደ (Where Did the Thief Go?)", 
        category: "Reversing", 
        points: 2500, 
        description: "The suspect's digital footprints are scattered across this executable file. Trace the execution flow to determine the thief's final destination (the hidden flag). You need to reverse engineer the binary to find the password or the key function. Download the file: <a href='https://drive.google.com/file/d/1EQ9rs8IKQ-AnVvufoqXCP3jGpd9-Avnz/view?usp=sharing' target='_blank' style='color:var(--accent2); text-decoration:underline;'>Click Here to Download</a>", 
        status: "unsolved", 
        flag: "TNCTF{TRACE_THE_F00TPRINT}" 
    }
];

const challengeListElement=document.getElementById('challenge-list');
const filterContainerElement=document.getElementById('category-filters');
const categories=['All',...new Set(challenges.map(c=>c.category))];

function updatePointsDisplay(){
  document.getElementById('currentPoints').textContent=mockUserPoints;
  updateRankDisplay();
}

function updateRankDisplay(){
  const data = JSON.parse(localStorage.getItem("leaderboardData")||"[]");
  const player = data.find(d=>d.email.toLowerCase()===loggedInEmail.toLowerCase());
  if(!player){document.getElementById('currentRank').textContent="—";return;}
  data.sort((a,b)=>b.score-a.score);
  const rank = data.findIndex(d=>d.email===player.email)+1;
  document.getElementById('currentRank').textContent = rank;
}

function submitFlag(challengeId, flagInput){
  const enteredFlag = flagInput.value.trim().toUpperCase();
  const challenge = challenges.find(c=>c.id===challengeId);
  if(!challenge) return showMessage("Error","Challenge not found.",false);
  if(challenge.status==="solved") return showMessage("Already Solved","You already solved this.",true);
  
  if(enteredFlag===challenge.flag.toUpperCase()){
    challenge.status="solved";
    mockUserPoints+=challenge.points;
    updatePointsDisplay();
    
    // Update Leaderboard Data
    if(localStorage.getItem("leaderboardData")){
      let data=JSON.parse(localStorage.getItem("leaderboardData"));
      let p=data.find(d=>d.email.toLowerCase()===loggedInEmail.toLowerCase());
      if(p){p.score+=challenge.points;p.last=new Date().toLocaleTimeString();}
      localStorage.setItem("leaderboardData",JSON.stringify(data));
    }
    
    showMessage("Flag Accepted!",`You earned ${challenge.points} points!`,true);
    renderChallenges(activeFilter);
  } else {
    showMessage("Flag Rejected","Incorrect flag. Try again!",false);
  }
}

function showMessage(title,message,isSuccess=false){
  const modal=document.getElementById('custom-message-modal');
  modal.innerHTML=`
  <div class="modal-content" style="border-color:${isSuccess?'var(--success)':'var(--accent2)'}; box-shadow:0 10px 50px ${isSuccess?'rgba(110,231,183,0.5)':'rgba(141,74,245,0.8)'}">
    <h3 id="modal-title">${title}</h3>
    <div id="modal-message">${message}</div>
    <button class="modal-button" onclick="document.getElementById('custom-message-modal').style.display='none'">Close</button>
  </div>`;
  modal.style.display='flex';
}

function renderChallenges(filter){
  challengeListElement.innerHTML='';
  const filtered = filter==='All'?challenges:challenges.filter(c=>c.category===filter);
  filtered.forEach(ch=>{
    const card=document.createElement('div');
    card.className='challenge-card';
    card.innerHTML=`
      ${ch.status==='solved'?'<div class="status-solved">SOLVED</div>':''}
      <div class="card-header"><h3>${ch.name}</h3><span class="points-tag">${ch.points} pts</span></div>
      <p>${ch.description}</p>
      <div class="card-footer"><span class="category-tag">${ch.category}</span></div>`;
    card.onclick=()=>{
      // Flag is hidden for solved challenges
      if(ch.status==='solved'){
          showMessage(
              ch.name,
              `You already solved this! The flag is now redacted to maintain challenge integrity.`,
              true
          );
      }
      else{
        const modal=document.getElementById('custom-message-modal');
        modal.innerHTML=`
          <div class="modal-content">
            <h3 id="modal-title">${ch.name}</h3>
            <div id="modal-message">
              <p>${ch.description}</p>
              <input type="text" id="flag-input" placeholder="Enter Flag (TNCTF{...})" 
              style="width:100%;margin-top:10px;padding:10px;border-radius:8px;text-align:center;text-transform:uppercase;background:rgba(255,255,255,0.05);border:1px solid var(--accent1);">
            </div>
            <div style="display:flex;gap:10px;justify-content:center;">
              <button class="modal-button" onclick="submitFlag(${ch.id},document.getElementById('flag-input'))">Submit</button>
              <button class="modal-button" style="background:none;border:1px solid var(--muted);" onclick="document.getElementById('custom-message-modal').style.display='none'">Cancel</button>
            </div>
          </div>`;
        modal.style.display='flex';
      }
    };
    challengeListElement.appendChild(card);
  });
}

function renderFilters(){
  filterContainerElement.innerHTML='';
  categories.forEach(cat=>{
    const btn=document.createElement('button');
    btn.className=`filter-btn ${cat===activeFilter?'active':''}`;
    btn.textContent=cat;
    btn.onclick=()=>{activeFilter=cat;renderFilters();renderChallenges(activeFilter);};
    filterContainerElement.appendChild(btn);
  });
}

function init(){
    renderFilters();
    renderChallenges('All');
    updatePointsDisplay();
    // "Cheating Not Allowed" warning on page load
    showMessage(
        "ACCESS WARNING",
        "<p style='color:var(--error); font-weight:700;'>Cheating Not Allowed</p><p>All challenge attempts and client-side actions are monitored and logged. Enjoy the challenge responsibly.</p>",
        false // Not success, uses default warning style
    );
}
init();

// MATRIX BACKGROUND
const m_canvas=document.getElementById('matrix-canvas');
const m_ctx=m_canvas.getContext('2d');
let m_W=m_canvas.width=window.innerWidth;
let m_H=m_canvas.height=window.innerHeight;
const m_cols=Math.floor(m_W/16)+1;
const m_ypos=Array(m_cols).fill(0);
function drawMatrix(){
  m_ctx.fillStyle='rgba(10,2,20,0.05)';
  m_ctx.fillRect(0,0,m_W,m_H);
  m_ctx.fillStyle='rgba(192,132,252,0.8)';
  m_ctx.font='700 16px monospace';
  for(let i=0;i<m_cols;i++){
    const text="TENANETCTF0123456789"[Math.floor(Math.random()*20)];
    const x=i*16,y=m_ypos[i]*16;
    m_ctx.fillText(text,x,y);
    if(y>m_H&&Math.random()>0.975)m_ypos[i]=0;
    m_ypos[i]++;
  }
}
setInterval(drawMatrix,40);
window.addEventListener('resize',()=>{m_W=m_canvas.width=window.innerWidth;m_H=m_canvas.height=window.innerHeight;});

// PARTICLES BACKGROUND
const p_canvas=document.getElementById('particles-canvas');
const p_ctx=p_canvas.getContext('2d');
let p_W,p_H;let particles=[];
const particleCount=60;
function resizeParticlesCanvas(){
  p_W=p_canvas.width=window.innerWidth;
  p_H=p_canvas.height=window.innerHeight;
  particles=[];
  for(let i=0;i<particleCount;i++)particles.push(new Particle());
}
class Particle{
  constructor(){this.x=Math.random()*p_W;this.y=Math.random()*p_H;this.size=Math.random()*3+1;this.speedX=Math.random()*2-1;this.speedY=Math.random()*2-1;}
  update(){this.x+=this.speedX;this.y+=this.speedY;if(this.x>p_W)this.x=0;if(this.x<0)this.x=p_W;if(this.y>p_H)this.y=0;if(this.y<0)this.y=p_H;}
  draw(){p_ctx.fillStyle='rgba(200,100,255,0.5)';p_ctx.beginPath();p_ctx.arc(this.x,this.y,this.size,0,Math.PI*2);p_ctx.fill();}
}
function animateParticles(){
  p_ctx.clearRect(0,0,p_W,p_H);
  particles.forEach(p=>{p.update();p.draw();});
  requestAnimationFrame(animateParticles);
}
resizeParticlesCanvas();animateParticles();
window.addEventListener('resize',resizeParticlesCanvas);
</script>
<!-- Spotify Music Embed (Funk Playlist) -->
<div id="spotify-player" style="position:fixed; bottom:10px; right:10px; z-index:50; opacity:0.7; transition:opacity 0.3s;">
  <iframe 
    src="https://open.spotify.com/embed/playlist/37i9dQZF1DWWY64wDtewQt" 
    width="300" 
    height="80" 
    frameborder="0" 
    allowtransparency="true" 
    allow="encrypted-media">
  </iframe>
</div>
</body>
</html>


