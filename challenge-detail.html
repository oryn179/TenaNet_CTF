<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Challenge Detail — TenaNet CTF</title>
<style>
* {margin:0;padding:0;box-sizing:border-box;}
:root {
--bg-dark:#0a0214;
--accent1:#8d4af5;
--accent2:#c084fc;
--text:#e9d5ff;
--muted:#a78bfa;
--success:#6ee7b7;
--error:#f87171;
--card-bg:rgba(255,255,255,0.05);
}
body{font-family:'Poppins',sans-serif;background:var(--bg-dark);color:var(--text);display:flex;flex-direction:column;align-items:center;padding:20px;overflow-x:hidden;}
#matrix-canvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-2;}
header{width:100%;max-width:1200px;display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;}
header h1{font-size:2em;color:white;text-shadow:0 0 8px rgba(192,132,252,0.5);}
header button{background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;border:none;padding:12px 25px;border-radius:12px;font-weight:700;cursor:pointer;transition:0.2s;}
header button:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(141,74,245,0.5);}
.card{background:var(--card-bg);border-radius:20px;padding:30px;max-width:700px;width:100%;box-shadow:0 8px 30px rgba(0,0,0,0.5);}
.card h2{color:var(--accent2);margin-bottom:15px;font-size:1.5em;}
.card p{color:var(--muted);margin-bottom:10px;font-size:0.95em;}
.card label{display:block;margin:15px 0 5px;color:var(--muted);}
.card input{width:100%;padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,0.05);color:var(--text);}
.card input:focus{outline:none;border-color:var(--accent1);box-shadow:0 0 10px rgba(141,74,245,0.3);}
.card button{margin-top:15px;background:linear-gradient(90deg,var(--accent1),var(--accent2));color:white;border:none;padding:12px 20px;border-radius:12px;font-weight:700;cursor:pointer;transition:0.2s;}
.card button:hover{transform:translateY(-2px);}
.message{margin-top:10px;font-weight:600;}
</style>
</head>
<body>
<canvas id="matrix-canvas"></canvas>

<header>
<h1>Challenge Detail</h1>
<button id="backBtn">Back to Challenges</button>
</header>

<div class="card" id="challengeCard">
<h2 id="chTitle">Loading...</h2>
<p><strong>Category:</strong> <span id="chCategory">—</span></p>
<p><strong>Difficulty:</strong> <span id="chDifficulty">—</span></p>
<p id="chDescription">Fetching challenge description...</p>

<label for="flagInput">Submit Flag</label>
<input type="text" id="flagInput" placeholder="ytctf{your_flag_here}" />
<button id="submitFlagBtn">Submit Flag</button>
<div class="message" id="message"></div>
</div>

<script>
// MATRIX BACKGROUND
var canvas=document.getElementById('matrix-canvas'),ctx=canvas.getContext('2d');
var W=window.innerWidth,H=window.innerHeight;canvas.width=W;canvas.height=H;
var fontSize=16,columns=Math.floor(W/fontSize),drops=[];for(var i=0;i<columns;i++){drops[i]=0;}
var str="CTF 0123456789 ABCDEFGHIJKLMNOPQRSTUVWXYZ@#$%^&*-+=|";
function draw(){ctx.fillStyle="rgba(0,0,0,0.05)";ctx.fillRect(0,0,W,H);ctx.font="700 "+fontSize+"px monospace";ctx.fillStyle="var(--accent2)";for(var i=0;i<columns;i++){var index=Math.floor(Math.random()*str.length),x=i*fontSize,y=drops[i]*fontSize;ctx.fillText(str[index],x,y);if(y>=H&&Math.random()>0.99)drops[i]=0;drops[i]++;}}
window.addEventListener('resize',()=>{W=canvas.width=window.innerWidth;H=canvas.height=window.innerHeight;columns=Math.floor(W/fontSize);drops.length=columns;for(let i=0;i<columns;i++){if(typeof drops[i]==='undefined'){drops[i]=1;}}});
setInterval(draw,35);

// AUTH CHECK
const token=localStorage.getItem('tenanet_token');
if(!token){window.location.href='/login.html';}

// BACK BUTTON
document.getElementById('backBtn').addEventListener('click',()=>{window.location.href='/challenges.html';});

// GET CHALLENGE ID FROM URL
const urlParams = new URLSearchParams(window.location.search);
const chId = urlParams.get('id') || 1; // default to 1

// ELEMENTS
const titleEl=document.getElementById('chTitle');
const catEl=document.getElementById('chCategory');
const diffEl=document.getElementById('chDifficulty');
const descEl=document.getElementById('chDescription');
const flagInput=document.getElementById('flagInput');
const messageEl=document.getElementById('message');

// FETCH CHALLENGE DATA
fetch(`http://localhost:4000/api/challenges/${chId}`,{headers:{Authorization:`Bearer ${token}`}})
.then(res=>res.json())
.then(ch=>{
    titleEl.textContent=ch.title;
    catEl.textContent=ch.category;
    diffEl.textContent=ch.difficulty;
    descEl.textContent=ch.description;
})
.catch(()=>descEl.textContent='Failed to load challenge.');

// SUBMIT FLAG
document.getElementById('submitFlagBtn').addEventListener('click',()=>{
    const flag = flagInput.value.trim();
    if(!flag){messageEl.textContent='Please enter a flag.'; messageEl.style.color='var(--error)'; return;}
    messageEl.textContent='Submitting...'; messageEl.style.color='var(--muted)';

    fetch(`http://localhost:4000/api/challenges/${chId}/submit`,{
        method:'POST',
        headers:{'Content-Type':'application/json','Authorization':`Bearer ${token}`},
        body:JSON.stringify({flag})
    })
    .then(res=>res.json())
    .then(data=>{
        if(data.success){
            messageEl.textContent='Correct Flag! ✅';
            messageEl.style.color='var(--success)';
        } else {
            messageEl.textContent=data.error || 'Incorrect Flag ❌';
            messageEl.style.color='var(--error)';
        }
    })
    .catch(()=>{messageEl.textContent='Server Error ❌'; messageEl.style.color='var(--error)';});
});
</script>
</body>
</html>
